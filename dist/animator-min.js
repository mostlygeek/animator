// Generated by CoffeeScript 1.3.3
/*
# v0.0.2
# Copyright Futdut Games, Inc 2012
*/(function(){var e,t,n;(n=window.ready)==null&&(window.ready=function(e){var t,n;n=function(){if(!window.ready.fired)return window.ready.fired=!0,e()};if(document.readyState==="complete")return n();if(document.addEventListener)return document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1);if(document.attachEvent){t=function(){try{document.documentElement.doScroll("left")}catch(e){setTimeout(t,50);return}return n()},document.attachEvent("onreadystatechange",n),window.attachEvent("onload",n);if(document.documentElement&&document.documentElement.doScroll&&!window.frameElement)return t()}}),function(){var e,t,n,r,i;if(window.requestAnimationFrame)return;e=0,n=["ms","moz","webkit","o"];for(r=0,i=n.length;r<i;r++){t=n[r];if(window.requestAnimationFrame!=null)break;window.requestAnimationFrame=window[""+t+"RequestAnimationFrame"],window.cancelAnimationFrame=window[""+t+"CancelAnimationFrame"]||window[""+t+"CancelRequestAnimationFrame"]}return window.requestAnimationFrame==null&&(window.requestAnimationFrame=function(t,n){var r,i,s;return r=(new Date).getTime(),s=Math.max(0,16-(r-e)),i=window.setTimeout(function(){return t(r+s)},s),e=r+s,i}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){return clearTimeout(e)}),null}(),e=function(){function e(e,t,n,r,i,s){var o,u,a=this;this.canvasContext=n,this.time=r,this.offsetX=i,this.offsetY=s,this.startTime=Date.now(),this.lastFrame=0,u=new XMLHttpRequest,u.open("GET",e,!0),u.send(null),u.onreadystatechange=function(e){var t;t=e.currentTarget;if(t.readyState!==4)return;a.index=JSON.parse(t.responseText);if(a.img!=null)return a.ready()},o=new Image,o.src=t,o.onload=function(){a.img=o;if(a.index!=null)return a.ready()}}return e.prototype.curFrame=0,e.prototype.lastFrame=0,e.prototype.ready=!1,e.prototype.onready=function(e){return this.readyFn=e},e.prototype.ready=function(){this.frameCount=this.index.frames.length,this.frameDelay=this.time*1e3/this.frameCount,this.ready=!0;if(this.readyFn!=null)return this.readyFn()},e.prototype.draw=function(e){var t,n,r,i;e==null&&(e=Date.now());if(this.ready!==!0)return;i=Math.floor((e-this.startTime)/this.frameDelay),t=i%this.frameCount;if(t===this.lastFrame)return;return this.lastFrame=t,r=this.index.frames[t],n=r.spriteSourceSize,this.canvasContext.clearRect(0,0,this.canvasContext.canvas.width,this.canvasContext.canvas.height),this.canvasContext.drawImage(this.img,r.frame.x,r.frame.y,r.frame.w,r.frame.h,this.offsetX+n.x,this.offsetY+n.y,r.frame.w,r.frame.h),null},e}(),t=function(){function t(){var e,t=this;this.queue=[],e=function(n){var r,i,s,o;o=t.queue;for(i=0,s=o.length;i<s;i++)r=o[i],r.draw(n);return window.requestAnimationFrame(e)},window.requestAnimationFrame(e)}return t.prototype.init=function(){var e,t,n,r,i,s,o,u,a,f,l,c;r=document.querySelectorAll("canvas.Animator"),c=[];for(f=0,l=r.length;f<l;f++)n=r[f],i=n.getAttribute("data-index"),u=n.getAttribute("data-sprites"),a=parseFloat(n.getAttribute("data-time")),e=n.getAttribute("data-x"),t=n.getAttribute("data-y"),s=e!=null?parseInt(e):0,o=t!=null?parseInt(t):0,c.push(this.add(n,i,u,a,s,o));return c},t.prototype.add=function(t,n,r,i,s,o){var u,a;s==null&&(s=0),o==null&&(o=0);if(t.animation!=null)return;return a=t.getContext("2d"),u=new e(n,r,a,i,s,o),t.animation=u,this.queue.push(u),u},t.prototype.stop=function(e){},t}(),window.ready(function(){var e;return e=new t,window.Animator=e,e.init()})}).call(this);