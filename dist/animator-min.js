// Generated by CoffeeScript 1.3.3
/*
# v0.0.1
# Copyright Futdut Games, Inc 2012
*/(function(){var e,t,n;(n=window.ready)==null&&(window.ready=function(e){var t,n;n=function(){if(!window.ready.fired)return window.ready.fired=!0,e()};if(document.readyState==="complete")return n();if(document.addEventListener)return document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1);if(document.attachEvent){t=function(){try{document.documentElement.doScroll("left")}catch(e){setTimeout(t,50);return}return n()},document.attachEvent("onreadystatechange",n),window.attachEvent("onload",n);if(document.documentElement&&document.documentElement.doScroll&&!window.frameElement)return t()}}),function(){var e,t,n,r,i;if(window.requestAnimationFrame)return;e=0,n=["ms","moz","webkit","o"];for(r=0,i=n.length;r<i;r++){t=n[r];if(window.requestAnimationFrame!=null)break;window.requestAnimationFrame=window[""+t+"RequestAnimationFrame"],window.cancelAnimationFrame=window[""+t+"CancelAnimationFrame"]||window[""+t+"CancelRequestAnimationFrame"]}return window.requestAnimationFrame==null&&(window.requestAnimationFrame=function(t,n){var r,i,s;return r=(new Date).getTime(),s=Math.max(0,16-(r-e)),i=window.setTimeout(function(){return t(r+s)},s),e=r+s,i}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){return clearTimeout(e)}),null}(),e=function(){function e(e,t){this.canvasContext=e,this.time=t,this.startTime=Date.now(),this.lastFrame=0}return e.prototype.curFrame=0,e.prototype.lastFrame=0,e.prototype.ready=!1,e.prototype.onready=function(e){return this.readyFn=e},e.prototype.ready=function(e,t){this.index=e,this.img=t,this.frameCount=this.index.frames.length,this.frameDelay=this.time*1e3/this.frameCount,this.ready=!0;if(this.readyFn!=null)return this.readyFn()},e.prototype.draw=function(e){var t,n,r;e==null&&(e=Date.now());if(this.ready!==!0)return;r=Math.floor((e-this.startTime)/this.frameDelay),t=r%this.frameCount;if(t===this.lastFrame)return;return this.lastFrame=t,n=this.index.frames[t],this.canvasContext.clearRect(0,0,this.canvasContext.canvas.width,this.canvasContext.canvas.height),this.canvasContext.drawImage(this.img,n.frame.x,n.frame.y,n.frame.w,n.frame.h,0,0,n.frame.w,n.frame.h),null},e}(),t=function(){function t(){var e,t=this;this.queue=[],e=function(n){var r,i,s,o;o=t.queue;for(i=0,s=o.length;i<s;i++)r=o[i],r.draw(n);return window.requestAnimationFrame(e)},window.requestAnimationFrame(e)}return t.prototype.init=function(){var e,t,n,r,i,s,o,u;t=document.querySelectorAll("canvas.Animator"),u=[];for(s=0,o=t.length;s<o;s++)e=t[s],n=e.getAttribute("data-index"),r=e.getAttribute("data-sprites"),i=parseFloat(e.getAttribute("data-time")),u.push(this.add(e,n,r,i));return u},t.prototype.add=function(t,n,r,i){var s,o,u,a;if(t.animation!=null)return;return o=t.getContext("2d"),s=new e(o,i),a=new XMLHttpRequest,a.open("GET",n,!0),a.send(null),a.onreadystatechange=function(e){var t,n;n=e.currentTarget;if(n.readyState!==4)return;t=JSON.parse(n.responseText);if(typeof u!="undefined"&&u!==null)return s.ready(t,u)},u=new Image,u.src=r,u.onload=function(){if(typeof index!="undefined"&&index!==null)return s.ready(index,u)},t.animation=s,this.queue.push(s),s},t.prototype.stop=function(e){},t}(),window.ready(function(){var e;return e=new t,window.Animator=e,e.init()})}).call(this);